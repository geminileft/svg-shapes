<!DOCTYPE html>
<html>
    <head>
            <script type="text/javascript" src="./js/math_core.js"></script>
            <script type="text/javascript" src="./js/svg_core.js"></script>
            <script type="text/javascript" src="./js/layer1.js"></script>
            <script type="text/javascript" src="./js/diag_factory.js"></script>
    </head>
<body>
<div>Item:
    <select id="draw_item">
        <option value='database'>Database</option>
        <option value='object_store'>Object Store</option>
        <option value='file_store'>File Store</option>
        <option value='message_store'>Message Store</option>
        <option value='gear'>Gear</option>
        <option value='transform'>Transform</option>
        <option value='server'>Server</option>
        <option value='flat_file'>Flat File</option>
        <option value='report'>Report</option>
        <option value='screen'>Screen</option>
    </select><br />
    Size: <input id="draw_size" type="text" value="1" /><br />
    Mode: INSERT

</div>
<svg id="my_svg" width="2000" height="1000" style="border-style:solid">
    Sorry, your browser does not support inline SVG.
</svg>
 
<script>

function svg_mouse_down(e) {
    const tgt = e.currentTarget;
    const boundingRect = tgt.getBoundingClientRect();
	const xPosition = e.clientX - boundingRect.left - 3;
    const yPosition = e.clientY - boundingRect.top - 4;

    const draw_item_opts = document.getElementById("draw_item").options;
    const idx = draw_item_opts.selectedIndex;
    const opt = draw_item_opts[idx].value;


    const size = document.getElementById("draw_size").value;
    const sz_int = parseFloat(size);

    var item;
    var item_fn = null;
    
    if (opt == 'database') {
        item = diag.diag_db(xPosition, yPosition, sz_int);
    } else if (opt == 'object_store') {
        item = diag.diag_object_store(xPosition, yPosition, sz_int);
    } else if (opt == 'file_store') {
        item = diag.diag_file_store(xPosition, yPosition, sz_int);
    } else if (opt == 'message_store') {
        item = diag.diag_message_store(xPosition, yPosition, sz_int);
    } else if (opt == 'gear') {
        item_fn = diag_gear;
    } else if (opt == 'transform') {
        item_fn = diag_transform;
    } else if (opt == 'server') {
        item_fn = diag_server;
    } else if (opt == 'flat_file') {
        item_fn = diag_flatfile;
    } else if (opt == 'report') {
        item_fn = diag_report;
    } else if (opt == 'screen') {
        item_fn = diag_screen;
    }
    
    if (item_fn != null) {
        item = item_fn(xPosition, yPosition, sz_int);
    }
    diag.drawImmediateMulti(item);
}

var svg = document.getElementById('my_svg');

svg.addEventListener("mousedown", svg_mouse_down, false);

const diag = new DataFlowDiagram(svg);
diag.setInteractiveMode(DIAG_INTERACTIVE_MOVE);

</script>
</body>
</html>